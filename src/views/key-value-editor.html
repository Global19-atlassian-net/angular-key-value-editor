<ng-form name="forms.keyValueEditor" novalidate ng-if="entries">
  <!-- may use ng-messages for better validation, if needed -->
  <div class="key-value-editor" ng-model="entries" as-sortable="dragControlListeners">
    <div
      class="key-value-editor-entry"
      ng-class-odd="'odd'"
      ng-class-even="'even'"
      ng-repeat="entry in entries"
      as-sortable-item>
      <div
        class="form-group key-value-editor-input"
        ng-class="{ 'has-error' :  (forms.keyValueEditor['key-' + $index].$invalid) }">
        <input
          type="text"
          class="form-control"
          ng-class="{ '{{setFocusClass}}' : $last  }"
          id="key-{{$index}}"
          name="key-{{$index}}"
          placeholder="{{keyPlaceholder}}"
          ng-minlength="{{keyMinlength}}"
          maxlength="{{keyMaxlength}}"
          ng-model="entry.name"
          ng-readonly="isReadonlyAny || isReadonlySome(entry.name) || entry.isReadonlyKey || entry.isReadonly || entry.containsSecret"
          ng-pattern="keyValidator"
          ng-value
          ng-attr-key-value-editor-focus="{{$last}}">
        <span
          class="help-block"
          ng-show="(forms.keyValueEditor['key-' + $index].$error.pattern)">
          <span>{{ entry.keyValidatorError || keyValidatorError ||  'validation error' }}</span>
          <span ng-if="entry.keyValidatorErrorTooltip || keyValidatorErrorTooltip" class="help action-inline">
            <a aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="{{entry.keyValidatorErrorTooltip || keyValidatorErrorTooltip}}">
              <i class="{{entry.keyValidatorErrorTooltipIcon || keyValidatorErrorTooltipIcon}}"></i>
            </a>
          </span>
        </span>
        <span
          class="help-block"
          ng-show="(forms.keyValueEditor['key-' + $index].$error.minlength)">
          <span>Minimum character count is {{keyMinlength}}</span>
        </span>
      </div>
      <div
        class="form-group key-value-editor-input"
        ng-class="(forms.keyValueEditor['value-' + $index].$invalid && forms.keyValueEditor['value-' + $index].$dirty) ? 'has-error' : ''">
        <div class="input-group" ng-if="entry.containsSecret">
          <span class="input-group-addon">
            <span class="{{entry.secretValueIcon || secretValueIcon}}" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="{{entry.secretValueTooltip || secretValueTooltip}}"></span>
          </span>
          <input
            type="text"
            class="form-control"
            id="value-{{$index}}"
            name="value-{{$index}}"
            placeholder="{{valuePlaceholder}}"
            ng-minlength="{{valueMinlength}}"
            ng-maxlength="{{valueMaxlength}}"
            ng-model="entry.value"
            ng-readonly="isReadonlyAny || isReadonlySome(entry.name) || entry.isReadonly || entry.containsSecret"
            ng-pattern="valueValidator">
        </div>
        <input
          type="text"
          class="form-control"
          id="value-{{$index}}"
          name="value-{{$index}}"
          placeholder="{{valuePlaceholder}}"
          ng-minlength="{{valueMinlength}}"
          maxlength="{{valueMaxlength}}"
          ng-model="entry.value"
          ng-readonly="isReadonlyAny || isReadonlySome(entry.name) || entry.isReadonly || entry.containsSecret"
          ng-pattern="valueValidator"
          ng-if="!entry.containsSecret">
        <span
          class="help-block"
          ng-show="(forms.keyValueEditor['value-' + $index].$error.pattern)">
          <span>{{ entry.valueValidatorError || valueValidatorError ||  'validation error' }}</span>
          <span ng-if="entry.valueValidatorErrorTooltip || valueValidatorErrorTooltip" class="help action-inline">
            <a aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="{{entry.valueValidatorErrorTooltip || valueValidatorErrorTooltip}}">
              <i class="{{entry.valueValidatorErrorTooltipIcon || valueValidatorErrorTooltipIcon}}"></i>
            </a>
          </span>
        </span>
        <span
          class="help-block"
          ng-show="(forms.keyValueEditor['value-' + $index].$error.minlength)">
          <span>Minimum character count is {{valueMinlength}}</span>
        </span>
      </div>
      <div class="key-value-editor-buttons">
        <span
          ng-if="(!cannotSort)"
          class="fa fa-bars"
          role="button"
          aria-label="Move row"
          aria-grabbed="false"
          as-sortable-item-handle></span>
        <span
          class="pficon pficon-close as-sortable-item-delete"
          role="button"
          aria-label="Delete row"
          ng-hide="cannotDeleteAny || cannotDeleteSome(entry.name) || entry.cannotDelete"
          ng-click="deleteEntry($index, 1)"></span>
      </div>
    </div>

    <!-- the last one, placeholder -->
    <div
      class="key-value-editor-entry"
      ng-if="!cannotAdd">
      <div
        class="form-group key-value-editor-input">
        <input
          type="text"
          class="form-control"
          placeholder="{{keyPlaceholder}}"
          ng-focus="onFocusLast()">
      </div>
      <div
        class="form-group key-value-editor-input">
        <input
          type="text"
          class="form-control"
          placeholder="{{valuePlaceholder}}"
          ng-focus="onFocusLast()">
      </div>
    </div>
  </div>

</ng-form>
